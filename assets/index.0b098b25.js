var e=Object.assign;import{r as t,s as n,o as r,l as o,i as c,f as i,a,b as l,c as s,d,p as u,e as h,g as p,u as m,t as f,h as g,m as b,j as v,k as E,n as x,q as C,v as w}from"./vendor.89a71862.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const r=new URL(e,location),o=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,c)=>{const i=new URL(e,r);if(self[t].moduleMap[i])return n(self[t].moduleMap[i]);const a=new Blob([`import * as m from '${i}';`,`${t}.moduleMap['${i}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(a),onerror(){c(new Error(`Failed to import: ${e}`)),o(l)},onload(){n(self[t].moduleMap[i]),o(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/tsmind/assets/");const M=t.createContext({canvas:null,setCanvas:e=>{}});function y(t={}){const{label:n="New Node",direction:r="right"}=t;return e({root:t.root,id:Math.random().toString(36).slice(2),label:n,direction:r,expanded:!0,children:[]},t.root?{coord:t.coord}:{})}const k=t.createContext({startDragging:()=>{}}),$=20,R=20,S=10,D=5,z=5;function j(e){return{padding:`${D}px ${S}px`}}function N(t){const r=new DocumentFragment;function o(e){const t=document.createElement("span");return t.setAttribute("style",`position: absolute; visibility: hidden; user-select: none; white-space: no-wrap; ${Object.entries(j()).map((([e,t])=>`${e}: ${t}`)).join(";")}`),t.innerText=e.label,r.appendChild(t),t}const c=function t(n){const r=n.children.map(t),c=o(n);return e(e({coord:[0,0]},n),{children:r,size:()=>{const e=[c.clientWidth,c.clientHeight];return c.remove(),e}})}(t);return document.body.appendChild(r),function t(r){const o=r.children.map(t),c=r.size(),i=Math.max(c[1],$*(o.length-1)+n(o,"height"));return e(e({},r),{size:c,height:i,children:o})}(c)}function B(t){const n=n=>function(t,n){return function t(r){let o=0;for(const e of r.children)e.coord=[r.coord[0]+(r.size[0]/2+R+e.size[0]/2)*("left"===n?-1:1),r.coord[1]+o-r.height/2+e.height/2],o+=e.height+$;return e(e({},r),{children:r.children.map(t)})}(N(t))}(e(e({},t),{children:t.children.filter((e=>e.direction===n))}),n),r=n("right");return e(e({},r),{children:r.children.concat(n("left").children)})}function L(e){return{children:e.children.map(B)}}function P(e){return i(e,(e=>["children",e]))}function O(e){return t=P(e),[a(t),l(t)];var t}function T(e,t,n){const[i,a]=O(t);return r(o(i),c(a,n),e)}function U(e,t,n){return s(P(t),n,e)}function A(e,t){const[n,c]=O(t);return r(o(n),h(c,1),e)}function F(e,t){return[e[0]-t[0],e[1]-t[1]]}function X(e,t){const n=F(e,t);return Math.abs(n[0])+Math.abs(n[1])}const Y=function(e,t){return[e[0]+t[0],e[1]+t[1]]};function I(e){return`${e[0]},${e[1]}`}const _=t.memo((function(e){const{a:n,b:r}=e,o=Math.min(n[1],r[1]),c=Math.min(n[0],r[0]),i=Math.max(Math.abs(n[0]-r[0]),1),a=Math.max(Math.abs(n[1]-r[1]),1),l=[c,o],s=[r[0]-c,n[1]-o],d=[n[0]-c,r[1]-o];return t.createElement("svg",{viewBox:`0 0 ${i} ${a}`,style:{position:"absolute",zIndex:-1,top:o,left:c,width:i,height:a}},t.createElement("path",{d:`M${I(F(n,l))} C${I(s)} ${I(d)} ${I(F(r,l))}`,fill:"transparent",stroke:"black"}))})),H=t.memo((function(e){const{parent:n,child:r}=e;return t.createElement(_,{a:n.coord,b:Y(r.coord,[(z-r.size[0]/2)*("left"===r.direction?-1:1),0])})})),W=new Set,q=t.memo((function(n){const{node:r,editing:o}=n,[c,i]=t.useState(r.label.length),a=t.useRef(null),l=e(e({},j()),{height:r.size[1],border:"1px solid black",borderRadius:"5px",lineHeight:`${r.size[1]}px`,backgroundColor:"white",whiteSpace:"nowrap"});return t.useLayoutEffect((()=>{const e=document.getSelection();if(o&&e&&a.current){const t=new Range,n=Array.from(a.current.childNodes).find((e=>e.nodeValue));n&&(null==t||t.setStart(n,c),null==t||t.setEnd(n,c),e.removeAllRanges(),e.addRange(t))}}),[c,o]),t.createElement("div",{ref:a,className:"node",contentEditable:o,style:l,suppressContentEditableWarning:!0,onBlur:n.onBlur,onInput:t=>{var o,c;i(null!=(c=null==(o=window.getSelection())?void 0:o.getRangeAt(0).startOffset)?c:0),n.onChange(e(e({},r),{label:t.currentTarget.innerText}))}},r.label||" ")})),K=t.memo((function(n){const{node:c,path:i,getCoord:a}=n,[l,s]=t.useState(W.has(c.id)),u=t.useCallback((()=>s(!1)),[]),{canvas:h,setCanvas:p}=t.useContext(M),{startDragging:m}=t.useContext(k),f=t.useRef(null);function g(){const t=y({direction:c.direction});W.add(t.id);const n=U(h,i,e(e({},c),{expanded:!0}));p(function(e,t,n){return r(o(P(t).concat("children")),d(n),e)}(n,i,t))}t.useEffect((()=>{W.delete(c.id)}),[]);const[b,v]=F(c.coord,(E=c.size,x=.5,[E[0]*x,E[1]*x]));var E,x;return t.createElement(t.Fragment,null,c.children.map(((e,n)=>t.createElement("div",{key:e.id,className:e.dropPreview?"drop-preview":""},t.createElement(H,{parent:c,child:e}),t.createElement(K,{getCoord:a,node:e,path:[...i,n]})))),t.createElement("div",{ref:f,className:"node-wrap",style:{position:"absolute",top:v,left:b},onKeyDown:e=>{if("Enter"===e.key)if(e.preventDefault(),l)s(!1),f.current.focus();else{if(function(e){return!!e.root}(c))return g();const e=y();W.add(e.id),p(T(h,i,e))}else"Tab"===e.key&&(e.preventDefault(),s(!1),g())},tabIndex:-1,onMouseDown:e=>{const t=F(c.coord,a(e.clientX,e.clientY));m(n.path,((e,n)=>Y(a(e,n),t)),[e.clientX,e.clientY])},onDoubleClick:e=>{e.stopPropagation(),l||s(!0)}},t.createElement(q,{editing:l,node:c,onBlur:u,onChange:function(e){p(U(h,i,e))}})))}));function V(e){const{canvas:n}=e,{setCanvas:c}=t.useContext(M),i=t.useRef(null),a=t.useCallback(((e,t)=>{const{left:n,top:r}=i.current.getBoundingClientRect();return[e-n-300,t-r-300]}),[]);return t.createElement("div",{ref:i,style:{width:600,height:600},onMouseDown:e=>{e.detail>1&&e.preventDefault()},onDoubleClick:e=>{e.preventDefault(),c(r(o(["children"]),d(y({root:!0,label:"Free Node",coord:a(e.clientX,e.clientY)}))))}},t.createElement("div",{style:{transform:"translate(300px, 300px)"}},n.children.map(((e,n)=>t.createElement(K,{key:e.id,node:e,path:[n],getCoord:a}))),n.dragSource&&!n.dropTarget&&t.createElement(K,{node:n.dragSource,path:[],getCoord:a})))}const G={children:[{label:"Root",id:"root",expanded:!0,direction:"right",root:!0,coord:[0,0],children:[{label:"sup2",id:"sub2",direction:"right",expanded:!1,children:[{label:"sub4",id:"sub4",direction:"right",expanded:!1,children:[]},{label:"sub3",id:"sub3",direction:"right",expanded:!1,children:[]}]},{label:"sub5",id:"sub5",direction:"right",expanded:!1,children:[]},{label:"sub1",id:"sub1",direction:"left",expanded:!1,children:[]}]}]};function J(e,t){let n={value:-1/0,path:void 0};function r(e,o){const c=function(e,t){return-X(t,e.coord)}(e,t);c>n.value&&t[0]-e.coord[0]>R&&t[0]-e.coord[0]<100&&(n={value:c,path:[...o,0]}),e.children.filter((e=>!e.dropPreview)).forEach(((e,t)=>r(e,[...o,t])))}return e.children.forEach(((e,t)=>r(e,[t]))),n.path}const Q=p(document,"mousemove"),Z=p(document,"mouseup");let ee=[],te=[];function ne(){var n;const[o,c]=t.useState(G),i=t.useMemo((()=>L(o)),[o]),a=t.useRef(),l=m();function s(e){a.current=e,l()}const h=t.useCallback(((t,n,c)=>{const l=function(e,t){return u(P(t),e)}(i,t);Q.pipe(f(Z),g((e=>X([e.clientX,e.clientY],c)<10)),b((e=>n(e.clientX,e.clientY)))).pipe(b((e=>{var n;return[e,J(null!=(n=a.current)?n:A(i,t),e)]})),v((([n,r])=>{let c=A(o,t);r&&(c=T(c,r,e(e({},l),{children:[],dropPreview:!0,root:void 0}))),s(e(e({},L(c)),{dragSource:e(e({},l),{coord:n,children:[]}),dropTarget:r}))})),E(),x()).subscribe((n=>{"N"===n.kind&&p((o=>{const c=A(o,t),[,i]=n.value;return i?T(c,i,l):r(C("children"),d(e(e({},l),{coord:a.current.dragSource.coord,root:!0})),c)})),s(void 0)}))}),[o]),p=e=>(ee.push(o),te=[],c(e));return t.createElement(M.Provider,{value:{canvas:o,setCanvas:p}},t.createElement(k.Provider,{value:{startDragging:h}},t.createElement("div",{className:"App"},t.createElement("button",{onClick:function(){const e=ee.pop();e&&(te.push(o),c(e))}},"undo"),t.createElement("button",{onClick:function(){const e=te.pop();e&&(ee.push(o),c(e))}},"redo"),t.createElement(V,{canvas:null!=(n=a.current)?n:i}))))}w.render(t.createElement(t.StrictMode,null,t.createElement(ne,null)),document.getElementById("root"));
