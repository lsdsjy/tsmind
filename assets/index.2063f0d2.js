var e=Object.assign;import{r as t,s as n,o,l as r,i,a as c,b as a,c as l,d as s,f as d,v as u,e as h,g as m,t as p,m as f,h as g,j as b,k as v,n as E,p as x,q as C,u as w,w as M,x as y}from"./vendor.428ade37.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(n){const o=new URL(e,location),r=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((n,i)=>{const c=new URL(e,o);if(self[t].moduleMap[c])return n(self[t].moduleMap[c]);const a=new Blob([`import * as m from '${c}';`,`${t}.moduleMap['${c}']=m;`],{type:"text/javascript"}),l=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(a),onerror(){i(new Error(`Failed to import: ${e}`)),r(l)},onload(){n(self[t].moduleMap[c]),r(l)}});document.head.appendChild(l)})),self[t].moduleMap={}}}("/tsmind/assets/");const R=t.createContext({startDragging:()=>{}}),$=t.createContext({root:null,setRoot:e=>{}}),S=20,k=20,z=10,j=5,B=5;function D(e){return{padding:`${j}px ${z}px`}}function L(t){const o=new DocumentFragment;function r(e){const t=document.createElement("span");return t.setAttribute("style",`position: absolute; visibility: hidden; user-select: none; ${Object.entries(D()).map((([e,t])=>`${e}: ${t}`)).join(";")}`),t.innerText=e.label,o.appendChild(t),t}const i=function t(n){const o=n.children.map(t),i=r(n);return e(e({},n),{children:o,coord:[0,0],size:()=>{const e=[i.clientWidth,i.clientHeight];return i.remove(),e}})}(t);return document.body.appendChild(o),function t(o){const r=o.children.map(t),i=o.size(),c=Math.max(i[1],S*(r.length-1)+n(r,"height"));return e(e({},o),{size:i,height:c,children:r})}(i)}function P(t){const n=n=>function(t,n){return function t(o){let r=0;for(const e of o.children)e.coord=[o.coord[0]+(o.size[0]/2+k+e.size[0]/2)*("left"===n?-1:1),o.coord[1]+r-o.height/2+e.height/2],r+=e.height+S;return e(e({},o),{children:o.children.map(t)})}(L(t))}(e(e({},t),{children:t.children.filter((e=>e.direction===n))}),n),o=n("right");return e(e({},o),{children:o.children.concat(n("left").children)})}function O(e,t=!1,n=""){return{root:t,id:Math.random().toString(36).slice(2),label:n,direction:e,expanded:!0,children:[]}}function U(e,t){return[e[0]-t[0],e[1]-t[1]]}const A=function(e,t){return[e[0]+t[0],e[1]+t[1]]};function N(e){return`${e[0]},${e[1]}`}const F=t.memo((function(e){const{a:n,b:o}=e,r=Math.min(n[1],o[1]),i=Math.min(n[0],o[0]),c=Math.max(Math.abs(n[0]-o[0]),1),a=Math.max(Math.abs(n[1]-o[1]),1),l=[i,r],s=[o[0]-i,n[1]-r],d=[n[0]-i,o[1]-r];return t.createElement("svg",{viewBox:`0 0 ${c} ${a}`,style:{position:"absolute",zIndex:-1,top:r,left:i,width:c,height:a}},t.createElement("path",{d:`M${N(U(n,l))} C${N(s)} ${N(d)} ${N(U(o,l))}`,fill:"transparent",stroke:"black"}))})),I=t.memo((function(e){const{parent:n,child:o}=e;return t.createElement(F,{a:n.coord,b:A(o.coord,[(B-o.size[0]/2)*("left"===o.direction?-1:1),0])})})),_=new Set,T=t.memo((function(n){const{node:o,editing:r}=n,[i,c]=t.useState(o.label.length),a=t.useRef(null),l=e(e({},D()),{height:o.size[1],border:"1px solid black",borderRadius:"5px",lineHeight:`${o.size[1]}px`,backgroundColor:"white"});return t.useLayoutEffect((()=>{const e=document.getSelection();if(r&&e&&a.current){const t=new Range,n=Array.from(a.current.childNodes).find((e=>e.nodeValue));n&&(null==t||t.setStart(n,i),null==t||t.setEnd(n,i),e.removeAllRanges(),e.addRange(t))}}),[i,r]),t.createElement("div",{ref:a,className:"node",contentEditable:r,style:l,suppressContentEditableWarning:!0,onBlur:n.onBlur,onInput:t=>{var r,i;c(null!=(i=null==(r=window.getSelection())?void 0:r.getRangeAt(0).startOffset)?i:0),n.onChange(e(e({},o),{label:t.currentTarget.innerText}))}},o.label||" ")})),H=t.memo((function(e){const{node:n,path:d,getCoord:u}=e,[h,m]=t.useState(_.has(n.id)),p=t.useCallback((()=>m(!1)),[]),{root:f,setRoot:g}=t.useContext($),{startDragging:b}=t.useContext(R);t.useEffect((()=>{_.delete(n.id)}),[]);const[v,E]=[n.coord[0]-n.size[0]/2,n.coord[1]-n.size[1]/2];return t.createElement(t.Fragment,null,n.children.map(((e,o)=>t.createElement("div",{key:e.id,className:e.dropPreview?"drop-preview":""},t.createElement(I,{parent:n,child:e}),t.createElement(H,{getCoord:u,node:e,path:d.concat("children",o)})))),t.createElement("div",{className:"node-wrap",style:{position:"absolute",top:E,left:v},onKeyPressCapture:e=>{if("Enter"===e.key)if(e.preventDefault(),h)m(!1);else if(e.shiftKey)!function(){const e=O(n.direction);_.add(e.id),g(o(r(d.concat("children")),s(e),f))}();else{if(function(e){return!!e.root}(n))return;const e=O(n.direction);_.add(e.id),g(o(r(i(d)),c(a(d),e),f))}},tabIndex:-1,onMouseDown:t=>{const o=U(n.coord,u(t.clientX,t.clientY));b(e.path,((e,t)=>A(u(e,t),o)))},onDoubleClick:()=>{h||m(!0)}},t.createElement(T,{editing:h,node:n,onBlur:p,onChange:function(e){g(l(d,e,f))}})))}));function K(e){const{root:n}=e,o=t.useRef(null),r=t.useCallback(((e,t)=>{const{left:n,top:r}=o.current.getBoundingClientRect();return[e-n-300,t-r-300]}),[]);return t.createElement("div",{ref:o,style:{width:600,height:600}},t.createElement("div",{style:{transform:"translate(300px, 300px)"}},t.createElement(H,{node:n,path:[],getCoord:r}),e.dragSource&&t.createElement(H,{node:e.dragSource,path:[],getCoord:r})))}const W={label:"Root",id:"root",expanded:!0,direction:"right",children:[{label:"sup2",id:"sub2",direction:"right",expanded:!1,children:[{label:"sub4",id:"sub4",direction:"right",expanded:!1,children:[]},{label:"sub3",id:"sub3",direction:"right",expanded:!1,children:[]}]},{label:"sub5",id:"sub5",direction:"right",expanded:!1,children:[]},{label:"sub1",id:"sub1",direction:"left",expanded:!1,children:[]}]};function X(e,t){return-function(e,t){const n=U(e,t);return Math.abs(n[0])+Math.abs(n[1])}(t,e.coord)}const Y=d(document,"mousemove"),q=d(document,"mouseup");let V,G=[],J=[];function Q(){const[n,s]=t.useState(W),[d,y]=t.useState(),[S,z]=t.useState(),j=t.useMemo((()=>P(n)),[n]),[B,D]=t.useState(),L=t.useCallback(((t,d)=>{const R=r(t),$=u(R,j);y($);const S=h(Y.pipe(p(q),f((e=>d(e.clientX,e.clientY)))),m(void 0));S.subscribe((t=>{t&&y((n=>e(e({},n),{coord:t})))})),S.pipe(g((e=>!!e)),f((e=>V&&function(e,t){let n={value:-1/0,path:void 0};return function e(o,r){const i=X(o,t);i>n.value&&t[0]-o.coord[0]>k&&t[0]-o.coord[0]<100&&(n={value:i,path:r.concat(["children",0])}),o.children.filter((e=>!e.dropPreview)).forEach(((t,n)=>e(t,r.concat(["children",n]))))}(e,[]),n.path}(V,e))),b(((e,t)=>w(e,t))),v(void 0),E((s=>{let d=o(r(i(t)),C(a(t),1),n);if(s){const t=i(s);M(t,d)||(d=l(t,[],d)),d=o(r(t),c(a(s),e(e({},$),{children:[],dropPreview:!0})),d)}V=P(d),D(V),z(s)})),x()).subscribe((e=>{e&&s((n=>{let l=o(r(i(t)),C(a(t),1),n);return o(r(i(e)),c(a(e),$),l)})),D(void 0),y(void 0),z(void 0)}))}),[n]);return t.createElement($.Provider,{value:{root:n,setRoot:s}},t.createElement(R.Provider,{value:{startDragging:L}},t.createElement("div",{className:"App"},t.createElement("button",{onClick:function(){const e=G.pop();e&&(J.push(n),s(e))}},"undo"),t.createElement("button",{onClick:function(){const e=J.pop();e&&(G.push(n),s(e))}},"redo"),t.createElement(K,{root:null!=B?B:j,onChange:function(e){G.push(n),J=[],s(e)},dragSource:B&&d&&!S?e(e({},d),{children:[]}):void 0}))))}y.render(t.createElement(t.StrictMode,null,t.createElement(Q,null)),document.getElementById("root"));
