var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,c=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r,a=(e,t)=>{for(var n in t||(t={}))o.call(t,n)&&c(e,n,t[n]);if(r)for(var n of r(t))i.call(t,n)&&c(e,n,t[n]);return e},s=(e,r)=>t(e,n(r));import{r as l,f as d,s as u,o as p,l as m,a as h,i as f,b as g,c as x,d as b,e as v,g as y,R as E,t as w,h as C,j as k,k as M,m as z,n as $,u as S,p as R,q as P,v as D,w as N,x as O,y as T}from"./vendor.f56ac57b.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const j=l.exports.createContext({canvas:null,setCanvas:e=>{}}),B=20,Y=20,I=10,W=5,A=8,L=5,X=[600,600];function F(e={}){const{label:t="New Node",direction:n="right"}=e;return a({root:e.root,id:Math.random().toString(36).slice(2),label:t,direction:n,expanded:!0,children:[],summaries:[]},e.root?{coord:e.coord}:{})}const q=l.exports.createContext({startDragging:()=>{}});d(document,"mousedown");const K=d(document,"mousemove"),H=d(document,"mouseup");function V(e){return e.reduce(((e,t)=>{return n=e,r=t,{top:Math.min(n.top,r.top),left:Math.min(n.left,r.left),bottom:Math.max(n.bottom,r.bottom),right:Math.max(n.right,r.right)};var n,r}),{top:1/0,left:1/0,right:-1/0,bottom:-1/0})}function G(e){return a({position:"absolute",padding:`${W}px ${I}px`,border:"1px solid black",boxSizing:"border-box",borderRadius:"5px",backgroundColor:"white"},e.fixedWidth?{maxWidth:`${e.fixedWidth}px`,width:`${e.fixedWidth}px`,overflowWrap:"break-word",whiteSpace:"break-spaces"}:{whiteSpace:"nowrap"})}const J=new WeakMap;function Q(e){if(J.has(e))return J.get(e);const t=new DocumentFragment;const n=function e(n){const r=n.children.map(n.expanded?e:function e(t){return s(a({coord:[0,0]},t),{children:t.children.map(e),size:()=>[0,0]})}),o=function(e){const n=document.createElement("span");return n.setAttribute("style","visibility: hidden;"),Object.assign(n.style,G(e)),n.innerText=e.label,t.appendChild(n),n}(n);return s(a({coord:[0,0]},n),{children:r,size:()=>{const{width:e,height:t}=o.getBoundingClientRect(),n=[e,t];return o.remove(),n}})}(e);document.body.appendChild(t);const r=function e(t){const n=t.children.map(t.expanded?e:function e(t){return s(a({},t),{size:t.size(),height:0,children:t.children.map(e)})}),r=t.size(),o=Math.max(r[1],B*(n.length-1)+u(n,"height"));return s(a({},t),{size:r,height:o,children:n})}(n);return J.set(e,r),r}function U(e){const t=t=>function(e,t){function n(e){return s(a({},e),{children:e.children.map(n),summaries:[]})}return function e(r){let o=0,i={top:r.coord[1]-r.size[1]/2-A,bottom:r.coord[1]+r.size[1]/2+A,left:r.coord[0]-r.size[0]/2-A,right:r.coord[0]+r.size[0]/2+A};if(!r.expanded)return{node:s(a({},r),{children:r.children.map(n),summaries:[]}),rect:i};for(const n of r.children)n.coord=[r.coord[0]+(r.size[0]/2+Y+n.size[0]/2)*("left"===t?-1:1),r.coord[1]+o-r.height/2+n.height/2],o+=n.height+B;let c=r.children.map(e),l=c.map(((e,t)=>s(a({},e.node),{summaries:r.children[t].summaries.map(((e,t)=>s(a({},e),{rect:V(c.slice(t,t+e.count).map((e=>e.rect)))})))})));return i=V([i].concat(c.map((e=>e.rect)))),{node:s(a({},r),{children:l,summaries:r.summaries.map((e=>s(a({},e),{rect:i})))}),rect:i}}(Q(e)).node}(s(a({},e),{children:e.children.filter((e=>e.direction===t))}),t),n=t("right");return s(a({},n),{children:n.children.concat(t("left").children)})}function Z(e){return{children:e.children.map(U)}}function _(e){return h(e,(e=>["children",e]))}function ee(e){return t=_(e),[g(t),x(t)];var t}function te(e,t,n){return p(m(_(t)),n,e)}function ne(e,t,n){const[r,o]=ee(t);return p(m(r),f(o,n),e)}function re(e,t,n){return te(e,t,(()=>n))}function oe(e,t){const[n,r]=ee(t);return p(m(n),y(r,1),e)}function ie(e,t){return[e[0]-t[0],e[1]-t[1]]}function ce(e,t){const n=ie(e,t);return Math.abs(n[0])+Math.abs(n[1])}const ae=function(e,t){return[e[0]+t[0],e[1]+t[1]]};function se(e){return`${e[0]},${e[1]}`}const le=E.memo((function(e){const{a:t,b:n}=e,r=Math.min(t[1],n[1]),o=Math.min(t[0],n[0]),i=Math.max(Math.abs(t[0]-n[0]),1),c=Math.max(Math.abs(t[1]-n[1]),1),a=[o,r],s=[n[0]-o,t[1]-r],l=[t[0]-o,n[1]-r];return E.createElement("svg",{viewBox:`0 0 ${i} ${c}`,style:{position:"absolute",zIndex:-1,top:r,left:o,width:i,height:c}},E.createElement("path",{d:`M${se(ie(t,a))} C${se(s)} ${se(l)} ${se(ie(n,a))}`,fill:"transparent",stroke:"black"}))})),de=function(e){const[t,n]=l.exports.useState(!1);return E.createElement("span",{style:{opacity:Number(!e.expanded||t),position:"absolute",left:e.coord[0],top:e.coord[1],fontSize:"0.8rem",transform:"translate(-50%, -50%)",border:"solid 1px black",borderRadius:"1000px",width:"12px",height:"12px",backgroundColor:t?"gray":"white",lineHeight:"12px",textAlign:"center",userSelect:"none",cursor:"pointer",transition:t?"opacity .3s ease":""},onClick:e.toggle,onMouseOver:()=>n(!0),onMouseOut:()=>n(!1)},e.expanded?"-":e.count)},ue=E.memo((function(e){const{parent:t}=e,{children:n}=t,r=t.root||!t.children.length?t.coord:[t.coord[0]+t.size[0]/2+10,t.coord[1]];return E.createElement(E.Fragment,null,t.root||E.createElement(E.Fragment,null,E.createElement(le,{a:t.coord,b:r}),E.createElement(de,{coord:r,expanded:t.expanded,count:t.children.length,toggle:e.toggle})),t.expanded&&n.map(((e,t)=>E.createElement(le,{key:t,a:r,b:ae(e.coord,[(L-e.size[0]/2)*("left"===e.direction?-1:1),0])}))))})),pe=new Set,me=E.memo((function(e){const{node:t,editing:n}=e,[r,o]=l.exports.useState(t.label.length),i=l.exports.useRef(!1),c=l.exports.useRef(null);function d(n){var r,i;o(null!=(i=null==(r=window.getSelection())?void 0:r.getRangeAt(0).startOffset)?i:0),e.onChange(s(a({},t),{label:n}))}return l.exports.useLayoutEffect((()=>{const e=document.getSelection();if(n&&e&&c.current){const t=new Range,n=Array.from(c.current.childNodes).find((e=>e.nodeValue));n&&(null==t||t.setStart(n,r),null==t||t.setEnd(n,r),e.removeAllRanges(),e.addRange(t))}}),[r,n]),E.createElement("div",{ref:c,className:"editor",contentEditable:n,suppressContentEditableWarning:!0,onBlur:e.onBlur,onInput:e=>{i.current||d(e.currentTarget.innerText)},onCompositionStart:()=>{i.current=!0},onCompositionEnd:e=>{i.current=!1,d(e.currentTarget.innerText)}},t.label||" ")})),he=E.memo((function(e){let{node:t,path:n,getCoord:r}=e;const[o,i]=l.exports.useState(pe.has(t.id)),c=l.exports.useCallback((()=>i(!1)),[]),{canvas:d,setCanvas:u}=l.exports.useContext(j),{startDragging:h}=l.exports.useContext(q),f=l.exports.useRef(null);function g(e){u(re(d,n,e))}function x(){const e=F({direction:t.direction});pe.add(e.id);const r=re(d,n,s(a({},t),{expanded:!0}));u(function(e,t,n){return p(m(_(t).concat("children")),b(n),e)}(r,n,e))}l.exports.useEffect((()=>{pe.delete(t.id)}),[]),t=s(a({},t),{expanded:t.expanded||t.children.some((e=>e.dropPreview))});const[v,y]=ie(t.coord,(k=t.size,M=.5,[k[0]*M,k[1]*M]));var k,M;const z=s(a({},G(t)),{display:"flex",alignItems:"center",top:y,left:v,width:t.size[0],height:t.size[1]});return E.createElement(E.Fragment,null,E.createElement(ue,{parent:t,toggle:()=>{g(s(a({},t),{expanded:!t.expanded}))}}),t.expanded&&t.children.map(((e,o)=>E.createElement("div",{key:e.id,className:e.dropPreview?"drop-preview":""},e.summaries.map(((i,c)=>{const{top:a,left:s,right:l,bottom:d}=i.rect;return E.createElement("div",{key:`${e.id}-${i.count}`,style:{position:"absolute",top:`${a}px`,left:`${s}px`,width:l-s+"px",height:d-a+"px",border:"solid 2px black",boxSizing:"border-box",userSelect:"none",zIndex:-100}},E.createElement("div",{style:{position:"absolute",bottom:"-2px",height:"5px",cursor:"s-resize",width:"100%"},onMouseDown:i=>{i.stopPropagation();const a=o,s=i.target.parentElement,l=r(0,i.clientY)[1],d=s.getBoundingClientRect().height;let h=r(0,i.clientY)[1];K.pipe(w(H)).subscribe({next:e=>{s.style.height=`${r(0,e.clientY)[1]-l+d}px`,h=r(0,e.clientY)[1]},complete:()=>{const[,o]=r(0,h),i=t.children.filter((t=>t.direction===e.direction)),l=Math.max(a,C((e=>e.coord[1]<=o),i));s.style.height=`${d}px`,u((e=>te(e,[...n,a],p(m(["summaries",c,"count"]),(()=>l-a+1)))))}})}}),i.label)})),E.createElement(he,{getCoord:r,node:e,path:[...n,o]})))),E.createElement("div",{ref:f,className:"node-wrap node",style:z,onKeyDown:e=>{if("Enter"===e.key)if(e.preventDefault(),o)i(!1),f.current.focus();else{if(function(e){return!!e.root}(t))return x();const e=F();pe.add(e.id),u(ne(d,n,e))}else"Tab"===e.key&&(e.preventDefault(),i(!1),x())},tabIndex:-1,onMouseDown:n=>{if(o)return;const i=ie(t.coord,r(n.clientX,n.clientY));h(e.path,((e,t)=>ae(r(e,t),i)),[n.clientX,n.clientY])},onDoubleClick:e=>{o||(e.stopPropagation(),o||i(!0))}},E.createElement("div",{className:"resizer",onMouseDown:e=>{e.stopPropagation();const r=e.clientX,o=f.current.getBoundingClientRect().width;K.pipe(w(H)).subscribe((e=>{const i=o+e.clientX-r;i<10||u((e=>re(e,n,s(a({},t),{fixedWidth:i}))))}))}}),E.createElement(me,{editing:o,node:t,onBlur:c,onChange:g})))}));function fe(e){const{canvas:t}=e,{setCanvas:n}=l.exports.useContext(j),r=l.exports.useRef(null),[o,i]=X,c=l.exports.useCallback(((e,t)=>{const{left:n,top:c}=r.current.getBoundingClientRect();return console.log(r.current.scrollLeft,r.current.scrollTop),[e-n-o/2+r.current.scrollLeft/1.5,t-c-i/2+r.current.scrollTop/1.5]}),[]);return E.createElement("div",{ref:r,style:{width:`${o}px`,height:`${i}px`,overflow:"scroll"},onDoubleClick:e=>{e.target===r.current&&(e.preventDefault(),n(p(m(["children"]),b(F({root:!0,label:"Free Node",coord:c(e.clientX,e.clientY)})))))}},E.createElement("div",{style:{width:`${o}px`,height:`${i}px`,transform:"scale(1.5)"}},E.createElement("div",{style:{transform:`translate(${o/2}px, ${i/2}px)`}},t.children.map(((e,t)=>E.createElement(he,{key:e.id,node:e,path:[t],getCoord:c}))),t.dragSource&&!t.dropTarget&&E.createElement(he,{node:t.dragSource,path:[],getCoord:c}))))}const ge={children:[{label:"Root",id:"root",expanded:!0,direction:"right",root:!0,coord:[0,0],summaries:[],children:[{label:"sup2",id:"sub2",direction:"right",expanded:!1,summaries:[{count:1,label:"summ"}],children:[{label:"sub4",id:"sub4",direction:"right",expanded:!1,children:[],summaries:[]},{label:"sub3",id:"sub3",direction:"right",expanded:!1,children:[],summaries:[]}]},{label:"sub5",id:"sub5",direction:"right",expanded:!1,children:[],summaries:[]},{label:"sub1",id:"sub1",direction:"left",expanded:!1,children:[],summaries:[]}]}]};function xe(e,t){let n={value:-1/0,path:void 0};function r(e,o){const i=function(e,t){return-ce(t,e.coord)}(e,t);i>n.value&&t[0]-e.coord[0]>Y&&t[0]-e.coord[0]<100&&(n={value:i,path:[...o,0]}),e.children.filter((e=>!e.dropPreview)).forEach(((e,t)=>r(e,[...o,t])))}return e.children.filter((e=>!e.dropPreview)).forEach(((e,t)=>r(e,[t]))),n.path}let be=[],ve=[];function ye(){var e;const t=l.exports.useRef(ge),n=l.exports.useMemo((()=>Z(t.current)),[t.current]),r=l.exports.useRef(),o=S();function i(e){t.current="function"==typeof e?e(t.current):e,o()}function c(e){r.current=e,o()}const d=l.exports.useCallback(((e,o,i)=>{const l=function(e,t){return v(_(t),e)}(n,e);K.pipe(w(H),R((e=>ce([e.clientX,e.clientY],i)<10)),P((e=>o(e.clientX,e.clientY)))).pipe(((...e)=>t=>k(t.pipe(z(1),$(...e)),t.pipe(M(1))))((()=>{r.current=oe(n,e),t.current=oe(t.current,e)})),P((e=>[e,xe(r.current,e)])),$((([e,n])=>{var r;n&&(t.current=te(t.current,g(n),(r=!0,e=>s(a({},e),{expanded:null!=r?r:!e.expanded}))));let o=t.current;n&&(o=ne(o,n,s(a({},l),{children:[],dropPreview:!0,root:void 0}))),c(s(a({},Z(o)),{dragSource:s(a({},l),{coord:e,children:[]}),dropTarget:n}))})),D(),N()).subscribe((e=>{"N"===e.kind&&u((t=>{let n=t;const[,o]=e.value;return o?(n=te(n,g(o),(e=>s(a({},e),{expanded:!0}))),ne(n,o,l)):p(O("children"),b(s(a({},l),{coord:r.current.dragSource.coord,root:!0})),n)})),c(void 0)}))}),[t.current]),u=e=>(be.push(t.current),ve=[],i(e));return E.createElement(j.Provider,{value:{canvas:t.current,setCanvas:u}},E.createElement(q.Provider,{value:{startDragging:d}},E.createElement("div",{className:"App"},E.createElement("button",{onClick:function(){const e=be.pop();e&&(ve.push(t.current),i(e))}},"undo"),E.createElement("button",{onClick:function(){const e=ve.pop();e&&(be.push(t.current),i(e))}},"redo"),E.createElement(fe,{canvas:null!=(e=r.current)?e:n}))))}T.render(E.createElement(E.StrictMode,null,E.createElement(ye,null)),document.getElementById("root"));
